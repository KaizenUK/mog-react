---
import Layout from "../../layouts/Layout.astro";
import { getTechnicalLibraryItems } from "../../lib/sanity/technicalLibrary";

const items = await getTechnicalLibraryItems();

function labelDocType(t) {
  if (t === "tds") return "TDS (Technical Data Sheet)";
  if (t === "sds") return "SDS (Safety Data Sheet)";
  return "Other";
}
---

<Layout title="Technical Library">
  <main class="mx-auto max-w-6xl px-4 py-10">
    <header class="mb-8">
      <h1 class="text-3xl font-semibold">Technical Library</h1>
      <p class="mt-2 text-base opacity-80">
        Download technical documents including TDS/SDS and related PDFs.
      </p>
    </header>

    {items?.length ? (
      <ul class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {items.map((d) => (
          <li class="rounded-2xl border p-5">
            <h2 class="text-lg font-semibold leading-snug">{d.title}</h2>

            <p class="mt-1 text-xs opacity-70">
              {labelDocType(d.docType)}
              {d.language ? ` â€¢ ${d.language.toUpperCase()}` : ""}
            </p>

            {d.relatedProductSlugs?.length ? (
              <div class="mt-3 text-sm">
                <p class="opacity-80">Related products:</p>
                <ul class="mt-2 flex flex-wrap gap-2">
                  {d.relatedProductSlugs.map((slug) => (
                    <li>
                      <a class="hover:underline" href={`/product/${slug}`}>
                        {slug}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ) : null}

            {d.url ? (
              <div class="mt-4">
                <a
                  class="inline-flex rounded-full border px-4 py-2 text-sm font-medium hover:opacity-80"
                  href={d.url}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Download PDF
                </a>
              </div>
            ) : null}
          </li>
        ))}
      </ul>
    ) : (
      <p>No documents found.</p>
    )}
  </main>
</Layout>
