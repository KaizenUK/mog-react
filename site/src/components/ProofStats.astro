---
const stats = [
  {
    figure: "5,000+",
    countTo: 5000,
    label: "Products",
    sentence: "Across our brand portfolio, with bespoke formulation available for specific client needs via our in-house laboratory team.",
  },
  {
    figure: "40+",
    countTo: 40,
    label: "Years' Experience",
    sentence: "In specialist small-pack filling — from NHS syringes and pharmaceutical lines to automotive and industrial packs.",
  },
  {
    figure: "250+",
    countTo: 250,
    label: "Industrial Products",
    sentence: "Covering cutting fluids, metalworking lubricants, and engineering oils for the manufacturing and engineering sectors.",
  },
];
---

<section class="proof">
  <div class="proof__inner">
    <p class="proof__eyebrow">By The Numbers</p>
    <div class="proof__grid">
      {stats.map((stat, i) => (
        <div class="proof__stat">
          <span
            class="proof__figure"
            data-count={stat.countTo}
            data-original={stat.figure}
            aria-label={stat.figure}
          >{stat.figure}</span>
          <span class="proof__label">{stat.label}</span>
          <p class="proof__sentence">{stat.sentence}</p>
          {i < stats.length - 1 && <div class="proof__divider" aria-hidden="true" />}
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  const easeOut = (t: number) => 1 - Math.pow(1 - t, 3);

  function animateFigure(el: HTMLElement) {
    const target = parseInt(el.dataset.count ?? "0");
    const original = el.dataset.original ?? "";
    const hasSuffix = original.includes("+");
    const duration = 1600;
    const start = performance.now();

    function tick(now: number) {
      const elapsed = now - start;
      const progress = Math.min(elapsed / duration, 1);
      const value = Math.round(easeOut(progress) * target);

      const formatted =
        target >= 1000
          ? new Intl.NumberFormat("en-GB").format(value)
          : String(value);

      el.textContent = formatted + (hasSuffix ? "+" : "");

      if (progress < 1) requestAnimationFrame(tick);
    }

    // Start from 0
    el.textContent = "0" + (hasSuffix ? "+" : "");
    requestAnimationFrame(tick);
  }

  const stats = document.querySelectorAll<HTMLElement>(".proof__stat");

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (!entry.isIntersecting) return;
        // Reveal the card
        (entry.target as HTMLElement).classList.add("is-visible");
        // Find the figure inside and animate it
        const fig = entry.target.querySelector<HTMLElement>(".proof__figure[data-count]");
        if (fig) animateFigure(fig);
        observer.unobserve(entry.target);
      });
    },
    { threshold: 0.3 }
  );

  stats.forEach((el, i) => {
    // Stagger reveal via CSS custom property
    el.style.setProperty("--stagger", String(i));
    observer.observe(el);
  });
</script>

<style>
  .proof {
    background:
      radial-gradient(ellipse at 50% -10%, rgba(200, 160, 52, 0.07) 0%, transparent 60%),
      var(--page-bg-alt);
    padding: var(--section-py) var(--section-px);
    border-top: 1px solid var(--border-subtle);
  }

  .proof__inner {
    max-width: var(--page-max);
    margin: 0 auto;
  }

  .proof__eyebrow {
    font-family: var(--font-heading);
    font-size: 12px;
    font-weight: 400;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: var(--nav-accent);
    margin: 0 0 52px;
    text-align: center;
  }

  .proof__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    position: relative;
  }

  /* ── Reveal animation ── */
  .proof__stat {
    padding: 0 40px;
    position: relative;
    opacity: 0;
    transform: translateY(28px);
    transition:
      opacity 0.6s ease calc(var(--stagger, 0) * 120ms),
      transform 0.6s ease calc(var(--stagger, 0) * 120ms);
  }

  .proof__stat.is-visible {
    opacity: 1;
    transform: none;
  }

  .proof__stat:first-child {
    padding-left: 0;
  }

  .proof__stat:last-child {
    padding-right: 0;
  }

  .proof__figure {
    display: block;
    font-family: var(--font-heading);
    font-size: clamp(56px, 7vw, 88px);
    font-weight: 600;
    letter-spacing: -0.02em;
    color: var(--nav-accent);
    line-height: 1;
    margin-bottom: 8px;
    /* Subtle glow on the number */
    text-shadow: 0 0 40px rgba(200, 160, 52, 0.25);
  }

  .proof__label {
    display: block;
    font-family: var(--font-heading);
    font-size: 12px;
    font-weight: 400;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 20px;
  }

  .proof__sentence {
    font-family: var(--font-body);
    font-size: 15px;
    line-height: 1.75;
    color: var(--text-secondary);
    margin: 0;
  }

  .proof__divider {
    position: absolute;
    top: 0;
    right: 0;
    width: 1px;
    height: 100%;
    background: linear-gradient(to bottom, transparent, var(--border-gold) 20%, var(--border-gold) 80%, transparent);
  }

  @media (max-width: 900px) {
    .proof__grid {
      grid-template-columns: 1fr;
      gap: 48px;
    }

    .proof__stat {
      padding: 0;
    }

    .proof__divider {
      display: none;
    }
  }
</style>
